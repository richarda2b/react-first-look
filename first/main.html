<!doctype html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="main.css">
    <meta charset="utf-8" />
    <title>i'm in a React.app!</title>
  </head>
  <body>
    <div id="React.app"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.4.2/react-dom.js"></script>
    <script type="text/javascript">
      var ContactItem = React.createClass({
        propTypes: {
          name: React.PropTypes.string.isRequired,
          email: React.PropTypes.string.isRequired,
          description: React.PropTypes.string
        },

        render: function() {
          return (
            React.createElement('li', {className: 'ContactItem'},
              React.createElement('h2', {className: 'ContactItem-name'}, this.props.name),
              React.createElement('a', {href: 'mailto:'+this.props.email, className: 'ContactItem-email'}, this.props.email),
              React.createElement('h3', {className: 'ContactItem-description'}, this.props.description)
            )
          )
        }
      })

      var ContactForm = React.createClass({
        propTypes: {
          contact: React.PropTypes.object.isRequired,
          onChange: React.PropTypes.func.isRequired
        },


        render: function() {

          var updatedChange = (fields) => {
            var updated = Object.assign({}, this.props.contact, fields)
            this.props.onChange(updated)
          }

          return (
              React.createElement('form', {className: "ContactForm"},
                React.createElement('input', {
                  placeholder: 'Name (Required)',
                  type: 'text',
                  value: this.props.contact.name,
                  onChange: (event) => updatedChange({"name": event.target.value})
                }),
                React.createElement('input', {
                  placeholder: 'Email',
                  type: 'email',
                  value: this.props.contact.email,
                  onChange: (event) => updatedChange({"email": event.target.value})
                }),
                React.createElement('textarea', {
                  placeholder: 'Description',
                  value: this.props.contact.description,
                  onChange: (event) => updatedChange({"description": event.target.value})
                }),
                React.createElement('button', {type: "submit"}, 'Add contact')
              )
          )
        }
      })

      var ContactView = React.createClass({
        propTypes: {
          contacts: React.PropTypes.array.isRequired,
          newContact: React.PropTypes.object.isRequired,
          onContactChange: React.PropTypes.func.isRequired
        },

        render: function() {
          var contactList = this.props.contacts.filter(contact => contact.email)
                                               .map(contact => React.createElement(ContactItem, contact))

          return (
            React.createElement('div', {className: "ContactView"},
              React.createElement('h1', {className: "ContactView-title"}, "Contacts"),
              React.createElement('ul', {className: "ContactView-list"}, contactList),
              React.createElement(ContactForm, {
                contact: this.props.newContact,
                onChange: (contact) => { console.log(contact) ; this.props.onContactChange(contact) }
              })
            )
          )
        }
      })


      /////////////// MODEL //////////////

      var testContacts = [
        {key: 1, name: "Bob Sponge", email: "bob@example.com", description: "Ninja"},
        {key: 3, name: "Marco Polo", email: "mc@example.com", description: "Animal"},
        {key: 2, name: "Patrik Star", description: "Sea Star!"}
      ]

      var newContact = {name: "", email: "", description: ""}

      var initialState = {
        contacts: testContacts,
        newContact: newContact
      }


      ////////// State foo //////////////

      var contactUpdated = (state) => (contact) => {
        var newState = Object.assign({}, state, {newContact: contact})
        console.log(newState)
        updateTheWorld(newState)
      }

      function updateTheWorld(state) {
        var rootElement = React.createElement(ContactView, Object.assign({}, state, {onContactChange: contactUpdated(state)}))

        ReactDOM.render(rootElement, document.getElementById('React.app'))
      }

      updateTheWorld(initialState)

    </script>

  </body>

</html>
